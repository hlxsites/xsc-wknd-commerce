{"version":3,"file":"event-bus.js","sources":["../../event-bus/src/index.ts"],"sourcesContent":["import { Events } from './events-catalog';\n\nexport * from './events-catalog';\n\nconst hash = Date.now().toString(36).substring(2);\n\n/**\n * The `events` class provides static methods for event handling.\n * It allows subscribing to events, emitting events, and enabling or disabling event logging.\n *\n * @class\n * @extends {Events}\n *\n * @property {Function} on - Subscribes to an event.\n * @property {Function} emit - Emits an event.\n * @property {Function} enableLogger - Enables or disables event logging.\n */\nexport class events {\n  static _identifier = hash;\n\n  static _logger: BroadcastChannel | null = null;\n\n  static _lastEvent: { [key: string]: { payload: any } } = {};\n\n  /**\n   * Subscribes to an event.\n   * @param event - The event to subscribe to.\n   * @param handler - The event handler.\n   * @param options - Optional configuration for the event handler.\n   */\n  static on<K extends keyof Events>(\n    event: K,\n    handler: (payload: Events[K]) => void,\n    options?: { eager?: boolean }\n  ) {\n    if (typeof BroadcastChannel === 'undefined') {\n      return;\n    }\n\n    const subscriber = new BroadcastChannel('ElsieSDK/EventBus');\n\n    if (options?.eager) {\n      const lastEvent = this._lastEvent[event];\n\n      if (lastEvent) {\n        handler(lastEvent.payload);\n      }\n    }\n\n    subscriber.addEventListener('message', ({ data }) => {\n      // ignore events from other instances (only if identifier is set)\n      if (this._identifier && this._identifier !== data.identifier) return;\n\n      if (data.event === event) {\n        handler(data.payload);\n      }\n    });\n\n    // unsubscribe if leaving page\n    window.addEventListener('beforeunload', () => {\n      subscriber.close();\n    });\n\n    return {\n      off() {\n        subscriber.close();\n      },\n    };\n  }\n  /**\n   * Emits an event.\n   * @param event - The event to emit.\n   * @param payload - The event payload.\n   */\n\n  static emit<K extends keyof Events>(event: K, payload: Events[K]) {\n    if (typeof BroadcastChannel === 'undefined') {\n      return;\n    }\n\n    const publisher = new BroadcastChannel('ElsieSDK/EventBus');\n\n    publisher.postMessage({ event, identifier: this._identifier, payload });\n\n    this._lastEvent[event] = {\n      payload,\n    };\n\n    publisher.close();\n  }\n  /**\n   * Enables or disables event logging.\n   * @param enabled - Whether to enable or disable event logging.\n   */\n  static enableLogger(enabled: boolean) {\n    if (typeof BroadcastChannel === 'undefined') {\n      return;\n    }\n\n    // reset logger\n    this._logger?.close();\n    this._logger = null;\n\n    if (enabled === false) return;\n\n    // create new logger\n    this._logger = new BroadcastChannel('ElsieSDK/EventBus');\n\n    this._logger.addEventListener('message', ({ data }) => {\n      if (this._identifier && this._identifier !== data.identifier) return;\n      console.group(`ðŸ“¡ Event (${data.identifier}) âž¡ ${data.event}`);\n      console.log(data.payload);\n      console.groupEnd();\n    });\n\n    // unsubscribe if leaving page\n    window.addEventListener('beforeunload', () => {\n      this._logger?.close();\n    });\n  }\n}\n"],"names":["hash","Date","now","toString","substring","events","on","event","handler","options","BroadcastChannel","subscriber","eager","lastEvent","_lastEvent","payload","addEventListener","data","_identifier","identifier","close","off","emit","publisher","postMessage","enableLogger","enabled","_a","_logger","console","group","log","groupEnd","__publicField"],"mappings":"wKAIA,MAAMA,EAAOC,KAAKC,MAAMC,SAAS,EAAE,EAAEC,UAAU,CAAC,EAazC,MAAMC,CAAO,CAalB,OAAOC,GACLC,EACAC,EACAC,EACA,CACI,GAAA,OAAOC,iBAAqB,IAC9B,OAGIC,MAAAA,EAAa,IAAID,iBAAiB,mBAAmB,EAE3D,GAAID,GAAAA,MAAAA,EAASG,MAAO,CACZC,MAAAA,EAAY,KAAKC,WAAWP,CAAK,EAEnCM,GACFL,EAAQK,EAAUE,OAAO,CAE7B,CAEWC,OAAAA,EAAAA,iBAAiB,UAAW,CAAC,CAAEC,KAAAA,CAAAA,IAAW,CAE/C,KAAKC,aAAe,KAAKA,cAAgBD,EAAKE,YAE9CF,EAAKV,QAAUA,GACjBC,EAAQS,EAAKF,OAAO,CACtB,CACD,EAGMC,OAAAA,iBAAiB,eAAgB,IAAM,CAC5CL,EAAWS,MAAM,CAAA,CAClB,EAEM,CACLC,KAAM,CACJV,EAAWS,MAAM,CACnB,CAAA,CAEJ,CAOA,OAAOE,KAA6Bf,EAAUQ,EAAoB,CAC5D,GAAA,OAAOL,iBAAqB,IAC9B,OAGIa,MAAAA,EAAY,IAAIb,iBAAiB,mBAAmB,EAE1Da,EAAUC,YAAY,CAAEjB,MAAAA,EAAOY,WAAY,KAAKD,YAAaH,QAAAA,CAAAA,CAAS,EAEjED,KAAAA,WAAWP,CAAK,EAAI,CACvBQ,QAAAA,CAAAA,EAGFQ,EAAUH,MAAM,CAClB,CAKA,OAAOK,aAAaC,EAAkB,CA1FxC,IAAAC,EA2FQ,OAAOjB,iBAAqB,OAKhCiB,EAAA,KAAKC,UAAL,MAAAD,EAAcP,QACd,KAAKQ,QAAU,KAEXF,IAAY,KAGXE,KAAAA,QAAU,IAAIlB,iBAAiB,mBAAmB,EAElDkB,KAAAA,QAAQZ,iBAAiB,UAAW,CAAC,CAAEC,KAAAA,CAAAA,IAAW,CACjD,KAAKC,aAAe,KAAKA,cAAgBD,EAAKE,aAClDU,QAAQC,MAAO,aAAYb,EAAKE,UAAW,OAAMF,EAAKV,KAAM,EAAC,EACrDwB,QAAAA,IAAId,EAAKF,OAAO,EACxBc,QAAQG,SAAS,EAAA,CAClB,EAGMhB,OAAAA,iBAAiB,eAAgB,IAAM,CAhHlD,IAAAW,GAiHMA,EAAA,KAAKC,UAAL,MAAAD,EAAcP,OAAM,CACrB,GACH,CACF,CAtGEa,EADW5B,EACJa,cAAclB,GAErBiC,EAHW5B,EAGJuB,UAAmC,MAE1CK,EALW5B,EAKJS,aAAkD,CAAA"}